<!DOCTYPE html>
<html>
<head>
    <title>角色管理器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <h1>游戏角色管理</h1>
    <nav style="background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: center;">
        <a href="/douququ" style="color: white; font-weight: bold; text-decoration: none; font-size: 1.1em;">
            🏆 进入斗蛐蛐模式
        </a>
    </nav>


    <form action="/create" method="POST">
        <button type="submit">创建新角色</button>
    </form>
    
    <div class="character-list">
        {% for char in characters %}
        <div class="character-card">
            {% if char.image %}
            <img src="{{ url_for('uploaded_file', filename=char.image) }}" alt="{{ char.name }}" class="character-image">
            {% endif %}
            <h2>{{ char.name }}</h2>
            <div class="character-meta">
              <span class="hp-badge">{{ char.stats.hp }} HP</span>
:start_line:30
-------
              <span class="element-tag element-{{ char.element }}">{{ char.element }}</span>
            </div>
            {% set char_win_rates = win_rates.get(char.id | string, {"total_battles": 0, "wins": 0}) %}
            {% set total_battles = char_win_rates.total_battles %}
            {% set wins = char_win_rates.wins %}
            {% set win_percentage = (wins / total_battles * 100) if total_battles > 0 else 0 %}
            <div class="win-rate">
                胜率: {{ "%.2f" | format(win_percentage) }}% ({{ wins }}胜 / {{ total_battles }}总)
            </div>
            <h3>攻击力:</h3>
            <ul>
                {% for element, value in char.stats.atk.items() %}
                {% if value > 0 %}
                <li>{{ element }}: {{ value }}</li>
                {% endif %}
                {% endfor %}
            </ul>
            
            {% if char.skills %}
            <div class="skills">
                <h3>技能:</h3>
                <ul>
                    {% for skill in char.skills %}
                    <li>
                        <strong>{{ skill.name }}:</strong>
                        <div class="skill-desc">{{ skill.effect }}</div>
                        {% if skill.damage %}
                        (伤害:
                        {% for element, value in skill.damage.items() %}
                        {% if value > 0 %}
                        {{ value }}{{ element }}
                        {% endif %}
                        {% endfor %})
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            {% if char.attributes %}
            <div class="attributes">
                <h3>特性:</h3>
                <ul>
                    {% for attr in char.attributes %}
                    <li>
                        <strong>{{ attr.name }}:</strong> 
                        {% if attr.resistance %}
                        (抗性: 
                        {% for element, value in attr.resistance.items() %}
                        {% if value > 0 %}
                        {{ value }}%{{ element }} 
                        {% endif %}
                        {% endfor %})
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="actions">
                <button onclick="location.href='/edit/{{ char.id }}'">编辑</button>
                <form action="/delete/{{ char.id }}" method="POST" style="display:inline;">
                    <button type="submit" class="delete-btn">删除</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    </div>
    <footer style="text-align: center; margin-top: 40px; padding: 20px; background-color: #f0f4ff; border-top: 1px solid #e1e5eb; border-radius: 8px; color: #777; font-size: 0.9em;">
      © 2025 卡牌游戏角色管理器
    </footer>
</body>
</html>